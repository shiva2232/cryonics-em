rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // This 'match' statement specifically targets the 'payloads' collection
    // The '{documentId}' is a wildcard, meaning these rules apply to ANY document
    // within the 'payloads' collection, regardless of its specific ID (like "8dJgm2UqLP3vAFIti7uA").
    match /payloads/{documentId} {

      // Rule for 'create' operations:
      // A user can create a new document in 'payloads' ONLY IF:
      // 1. They are authenticated (signed in).
      // 2. The 'userId' field in the data they are submitting for the new document
      //    is exactly equal to their own authenticated user ID (UID).
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;

      // Rules for 'read', 'update', and 'delete' operations:
      // A user can read, update, or delete an existing document in 'payloads' ONLY IF:
      // 1. They are authenticated (signed in).
      // 2. The 'userId' field that is ALREADY STORED in that document
      //    is exactly equal to their own authenticated user ID (UID).
      allow read, update, delete: if request.auth != null && request.auth.uid == resource.data.userId;
    }
  }
}